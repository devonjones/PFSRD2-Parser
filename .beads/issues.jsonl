{"id":"PFSRD2-Parser-0ry","title":"Consider extracting structured data from ammunition modifiers","description":"Ammunition modifiers currently store price and bulk as plain text (e.g., '100 gp, 2 Bulk'). Consider whether this data should be extracted into structured fields for better querying and consistency.\n\nCurrent format (all siege weapons follow this pattern):\n{\n  \"text\": \"bomb arrows\",\n  \"modifiers\": [{\"name\": \"100 gp, 2 Bulk\"}]\n}\n\nExamples from parsed data:\n- Alchemical Springald: bomb arrows (100 gp, 2 Bulk)\n- Blasting Ram: ram powder charge (2 gp, 1 Bulk)  \n- Bombard: stone spheres (4 gp, 4 Bulk)\n- Cannon: cannonball (10 gp, 6 Bulk)\n\nThree options to consider:\n1. Extract structured fields from text (price: {value: 100, unit: 'gp'}, bulk: 2)\n2. Reference ammunition database objects (like trait enrichment)\n3. Keep as-is (simple, works for display)\n\nDecision depends on downstream usage and query requirements.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-14T22:16:55.479880024Z","updated_at":"2026-01-14T23:10:00.690215438Z","comments":[{"id":1,"issue_id":"PFSRD2-Parser-0ry","author":"devon","text":"Currently ammunition modifiers contain mixed data like '100 gp, 2 Bulk' stored as a plain text modifier.\n\nExample from siege weapon (Alchemical Springald):\n{\n  \"text\": \"bomb arrows\",\n  \"modifiers\": [{\"name\": \"100 gp, 2 Bulk\"}]\n}\n\nThree possible approaches:\n1. Extract structured fields (price, bulk) from modifier text\n2. Reference full ammunition objects (similar to trait enrichment from DB)\n3. Leave as-is (current simple approach)\n\nTrade-offs:\n- Option 1: More structured but requires parsing logic for varied formats\n- Option 2: More complete data but requires ammunition database and linking\n- Option 3: Simple and works, but less queryable/processable\n\nNeed to consider:\n- How is this data used downstream?\n- Are there queries that need price/bulk of ammunition?\n- Is consistency with other equipment fields important?\n- What formats do ammunition modifiers actually use across all equipment?","created_at":"2026-01-14T22:17:13Z"}]}
{"id":"PFSRD2-Parser-1td","title":"Remove defensive empty check in _parse_immunities","description":"Lines 1671-1674: Checks for empty text and returns empty list. If parsing immunities from empty text, that's data quality issue that should be caught earlier.\n\nStrategic fragility: Remove check - let BeautifulSoup handle empty input (will return empty list naturally).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:57.58549182Z","updated_at":"2026-01-15T02:51:07.252064528Z","closed_at":"2026-01-15T02:51:07.252064528Z","close_reason":"Removed defensive empty check. BeautifulSoup handles empty input naturally. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-1td","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.172787732Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4et","title":"Remove unnecessary empty check in _count_links_in_html","description":"Lines 37-38: Defensive 'if not html_text: return 0' check. If counting links in non-existent HTML, that's likely a caller bug. BeautifulSoup handles empty strings fine.\n\nStrategic fragility: Remove check, let BeautifulSoup handle empty input (will just find no links).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:53:56.589943001Z","updated_at":"2026-01-15T00:36:29.137357511Z","closed_at":"2026-01-15T00:36:29.137357511Z","close_reason":"Removed defensive empty check. BeautifulSoup handles empty strings correctly. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-4et","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.013499315Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4qu","title":"Simplify try-except with re-raise in normalization","description":"Lines 1402-1404, 1640-1642, 1799-1801: Catching ValueError and re-raising with context. While context is useful, if input data is bad, should fail fast at parsing boundary, not here.\n\nStrategic fragility: Just convert - let ValueError propagate with its own message showing the bad value.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:35.670058561Z","updated_at":"2026-01-15T03:17:36.098910938Z","closed_at":"2026-01-15T03:17:36.098910938Z","close_reason":"Removed 10 try-except blocks with ValueError re-raise. Native ValueError messages already show bad values. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-4qu","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.11309246Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-70t","title":"Remove default None from group_subtype parameter","description":"Line 941: Function signature has group_subtype=None default, making it unclear if parameter is required or optional. This hides whether callers need to provide this value.\n\nStrategic fragility: No default - force caller to be explicit. Pass None at call site if not needed.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:48.820469569Z","updated_at":"2026-01-15T00:16:35.508688439Z","closed_at":"2026-01-15T00:16:35.508688439Z","close_reason":"Removed default None parameter. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-70t","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.993404124Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-auw","title":"Deduplicate trait_class_matcher function (defined 3 times)","description":"Lines 767-775, 800-807, 842-854: Same trait_class_matcher function defined THREE times in different scopes. Also has defensive 'if not c' check.\n\nStrategic fragility: Define once at module level, remove None check (BeautifulSoup API guarantees string or list).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:04.396741031Z","updated_at":"2026-01-15T00:44:41.266379586Z","closed_at":"2026-01-15T00:44:41.266379586Z","close_reason":"Deduplicated 3 identical function definitions into single module-level function. Kept defensive None check - testing revealed BeautifulSoup can pass None despite task description. All equipment types parse successfully.","dependencies":[{"issue_id":"PFSRD2-Parser-auw","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.032094631Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-bcl","title":"Implement siege weapons parser","description":"Add siege weapons as a new equipment type to PFSRD2-Parser. Parse siege weapon HTML files with stats (Price, Usage, Crew, Proficiency, etc.), defensive stats (AC, Fort, Ref), item hitpoints (HP, Hardness, Immunities), and action sections (Aim, Load, Launch, Ram). Actions may have attack-like properties (damage, range, saving throws). Must also parse item level (like 'Item 1').","design":"Following the extensible equipment architecture pattern from weapons/armor/shields. Key implementation steps:\n1. Schema: Renamed shield_hitpoints to item_hitpoints, added protection/protections defs for immunities support (DONE)\n2. Equipment.py: Created _normalize_item_hitpoints() with immunities parsing from creatures pattern (DONE)\n3. Equipment.py: Added siege_weapon configuration to EQUIPMENT_TYPES with recognized_stats mapping (DONE)\n4. Need to implement: _normalize_defensive_stats() for AC/Fort/Ref parsing\n5. Need to implement: _normalize_speed() for speed field\n6. Need to implement: Action section parsing (Aim, Load, Launch, Ram) using extract_action_type from pfsrd2.action\n7. Need to implement: Attack parsing for Launch actions (damage, range, DC, burst)\n8. Need to implement: Item level parsing ('Item 1' format)\n9. Schema: Add siege_weapon_object definition\n10. Test on all 32 HTML files","notes":"COMPLETED: Full siege weapon parser implementation.\n- Schema: item_hitpoints with immunities, siege_weapon_object definition, speed_with_modifiers\n- Equipment.py: siege_weapon config in EQUIPMENT_TYPES, _siege_weapon_section_pass, _extract_siege_weapon_stats (handles multi-\u003chr\u003e layout), _extract_action_sections (parses Aim/Load/Launch/Ram with action costs), normalize_siege_weapon_fields  \n- Parsing: item level from h1, all stats (usage/crew/proficiency/ammunition/space/ac/fort/ref/hardness/hp/immunities/speed), actions with action_type, traits, source, price\n- Normalization: defensive stats, speed with modifiers, item_hitpoints with immunities, immunities parser\nTESTED: Successfully parses Bombard (ID 12) with all fields correctly structured.\nNEXT: Test on remaining 31 files to identify edge cases, validate schema passes, create unified runner script.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-13T06:32:21.803545679Z","updated_at":"2026-01-13T06:48:10.422100884Z"}
{"id":"PFSRD2-Parser-cnd","title":"Remove defensive hardness deletion in hitpoints normalization","description":"Lines 1636-1642: Uses .get('hardness') and checks is not None. If hardness field exists, it should be valid. Empty/None hardness should fail.\n\nStrategic fragility: Use 'if hardness in sb' check, convert directly with int(sb['hardness']).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:43.740092565Z","updated_at":"2026-01-15T03:22:31.180286352Z","closed_at":"2026-01-15T03:22:31.180286352Z","close_reason":"Removed defensive .get() with None check. Simplified from 7 lines to 2 lines. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-cnd","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.132761019Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-flp","title":"Remove triple defensive check before parsing immunities","description":"Lines 1647-1652: Three levels of defensive checking: (1) field exists, (2) not empty, (3) parsed result not empty. Hides data quality issues.\n\nStrategic fragility: Just parse immunities if field exists, let parser handle empty input.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:50.668998566Z","updated_at":"2026-01-15T03:28:59.815774665Z","closed_at":"2026-01-15T03:28:59.815774665Z","close_reason":"Removed defensive empty string check. Simplified from 3-level checking to 2-level. BeautifulSoup handles empty strings naturally. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-flp","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.152777847Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-gcc","title":"Replace silent return with exception on empty stat block","description":"Lines 457-458, 496-497, 521-522: Multiple places use .get('text', '') and silently return 0 if empty. If stat block exists without text, that's a bug in earlier processing.\n\nStrategic fragility: Use sb['text'] to fail if missing, raise ValueError if empty instead of silently returning.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:12.048023959Z","updated_at":"2026-01-15T01:18:43.642250341Z","closed_at":"2026-01-15T01:18:43.642250341Z","close_reason":"Replaced silent returns with exceptions. Uses sb['text'] to fail if missing, raises ValueError if empty. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-gcc","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.051895217Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-l0b","title":"Simplify overly complex link counting in section removal","description":"Lines 1072-1078: Double-counts links by checking if element itself is a link AND finding descendant links. Defensive coding trying to handle all cases.\n\nStrategic fragility: Just use find_all with recursive=True - BeautifulSoup will find all links including elem itself.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:55:04.762880852Z","updated_at":"2026-01-15T03:32:51.397247371Z","dependencies":[{"issue_id":"PFSRD2-Parser-l0b","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.191231101Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-lkh","title":"Remove empty string handling in _extract_stat_value","description":"Lines 1015-1017: Checks for empty string and returns None. If stat label exists with no value, that's malformed HTML that should fail, not silently return None.\n\nStrategic fragility: Only handle em dash (explicit 'no value' marker), raise ValueError on empty string.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:19.834612083Z","updated_at":"2026-01-15T01:25:08.725585043Z","closed_at":"2026-01-15T01:25:08.725585043Z","close_reason":"Removed empty string handling. Only em dash is handled as 'no value' marker. Raises ValueError on empty string to catch malformed HTML. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-lkh","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.07175019Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-rev","title":"Remove defensive .get('group_subtype') hiding config errors","description":"Line 469: Using .get('group_subtype') with default None hides configuration errors. If group_subtype is required for an equipment type but missing from config, we silently pass None instead of failing fast.\n\nStrategic fragility: Force callers to pass group_subtype explicitly or use config['group_subtype'] to fail on missing config.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:41.632266784Z","updated_at":"2026-01-15T00:23:54.748292761Z","closed_at":"2026-01-15T00:23:54.748292761Z","close_reason":"Replaced defensive .get() with explicit fail-fast check. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-rev","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.974006533Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-roq","title":"Remove defensive type check in ammunition normalization","description":"Line 1996-1997: isinstance(html_str, dict) check with comment 'shouldn't be, but be defensive'. This hides bugs where ammunition is already a dict. Remove the check and let it fail with TypeError if html_str is not a string.\n\nStrategic fragility: If ammunition is already a dict, that's a bug that should fail loudly, not be silently skipped.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:34.403041289Z","updated_at":"2026-01-15T00:30:43.732680451Z","closed_at":"2026-01-15T00:30:43.732680451Z","close_reason":"Removed defensive isinstance check. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-roq","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.95375157Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-spu","title":"Move defensive equipment group check to call site","description":"Lines 1834-1836: Checks if 'group_table' in config inside the function. Defensive - function is called for all equipment types but shields don't have groups.\n\nStrategic fragility: Remove check from function, only call equipment_group_pass() from call site if config has group_table.","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:55:12.357321178Z","updated_at":"2026-01-15T03:33:04.331255878Z","dependencies":[{"issue_id":"PFSRD2-Parser-spu","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.209727934Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-x17","title":"Simplify complex defensive loop in _extract_description","description":"Lines 1220-1230: Complex defensive walking backward through siblings with multiple break conditions. Suggests lack of confidence in HTML structure.\n\nStrategic fragility: Trust HTML structure. Action icons should follow action names. Simplify to just remove span and preceding br.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:27.585984462Z","updated_at":"2026-01-15T02:33:06.498013372Z","closed_at":"2026-01-15T02:33:06.498013372Z","close_reason":"Simplified 30+ line defensive loop to simple 3-step removal. Trusts HTML structure. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-x17","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.091787278Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-xp4","title":"Remove defensive programming from PR #12","description":"Strategic fragility review of PR #12 identified 14 instances of defensive programming that should be removed. Each issue will be fixed one-by-one with testing on all equipment types (weapons, armor, shields, siege_weapons) to see what breaks.\n\nGoal: Make the code fail fast and loudly when invariants are violated instead of hiding bugs with defensive checks.\n\nCategories:\n- Critical (P0): 3 issues - Type checks, config hiding, default params\n- High (P1): 5 issues - Empty checks, duplicated code, silent returns  \n- Medium (P2): 6 issues - Try-except, complex conditionals\n\nTesting protocol for each fix:\n1. Apply fix\n2. Run full test suite on weapons, armor, shields, siege_weapons\n3. Document what breaks (if anything)\n4. Determine if breakage reveals real bugs or is acceptable\n\nRelated PR: #12 (shields support and equipment parsing unification)","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-15T00:00:27.910205877Z","updated_at":"2026-01-15T00:00:27.910205877Z"}
