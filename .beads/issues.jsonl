{"id":"PFSRD2-Parser-0lt","title":"Handle bulk field modifiers","description":"Parse bulk field modifiers into structured format instead of raw strings.\n\n**Current state:** Bulk is stored as a raw string, but some items have modifiers in parentheses that should be extracted.\n\n**Known pattern:**\n- Standard parenthetical modifiers like \"1 (or 2 when activated)\" or similar\n\n**Investigation needed:**\n- Explore the totality of bulk text values across all equipment to identify patterns\n- Run a query to extract unique bulk values and their frequencies\n- Identify which patterns warrant structured parsing vs. leaving as text\n\n**Example approach:**\n```bash\n# Find all unique bulk values\ngrep -h '\"bulk\":' ../pfsrd2-data/equipment/**/*.json | sort | uniq -c | sort -rn\n```\n\n**Likely fix:**\n- Use existing `string_with_modifiers()` or similar from universal.py\n- Extract modifier text into a modifiers array on the bulk object\n- Keep raw text in a \"text\" field for display purposes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T03:29:33.922588565Z","updated_at":"2026-01-23T04:58:19.917235389Z","closed_at":"2026-01-23T04:58:19.917235389Z","close_reason":"Implemented bulk modifier extraction for patterns like 'L (when not activated)', '1 (3 unfolded)'"}
{"id":"PFSRD2-Parser-0lu","title":"Refactor _extract_abilities_from_description for complexity","description":"Function _extract_abilities_from_description is 298 lines, far exceeding 50-60 line guideline. Should extract:\n- _parse_named_activation() for named activation parsing with mojibake handling\n- _parse_activation_traits() for trait link separation\n- _extract_ability_fields() for field extraction loop\n\nPre-existing complexity, not introduced by PR #32.\nFrom PR #32 review comment by complexity-reviewer.\nFile: pfsrd2/equipment.py:3027","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T01:46:35.241813082Z","updated_at":"2026-01-23T02:48:03.253623708Z","closed_at":"2026-01-23T02:48:03.253623708Z","close_reason":"Refactored _extract_abilities_from_description from 298 to ~160 lines by extracting three helper functions"}
{"id":"PFSRD2-Parser-0ry","title":"Consider extracting structured data from ammunition modifiers","description":"Ammunition modifiers currently store price and bulk as plain text (e.g., '100 gp, 2 Bulk'). Consider whether this data should be extracted into structured fields for better querying and consistency.\n\nCurrent format (all siege weapons follow this pattern):\n{\n  \"text\": \"bomb arrows\",\n  \"modifiers\": [{\"name\": \"100 gp, 2 Bulk\"}]\n}\n\nExamples from parsed data:\n- Alchemical Springald: bomb arrows (100 gp, 2 Bulk)\n- Blasting Ram: ram powder charge (2 gp, 1 Bulk)  \n- Bombard: stone spheres (4 gp, 4 Bulk)\n- Cannon: cannonball (10 gp, 6 Bulk)\n\nThree options to consider:\n1. Extract structured fields from text (price: {value: 100, unit: 'gp'}, bulk: 2)\n2. Reference ammunition database objects (like trait enrichment)\n3. Keep as-is (simple, works for display)\n\nDecision depends on downstream usage and query requirements.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-14T22:16:55.479880024Z","updated_at":"2026-01-14T23:10:00.690215438Z","comments":[{"id":1,"issue_id":"PFSRD2-Parser-0ry","author":"devon","text":"Currently ammunition modifiers contain mixed data like '100 gp, 2 Bulk' stored as a plain text modifier.\n\nExample from siege weapon (Alchemical Springald):\n{\n  \"text\": \"bomb arrows\",\n  \"modifiers\": [{\"name\": \"100 gp, 2 Bulk\"}]\n}\n\nThree possible approaches:\n1. Extract structured fields (price, bulk) from modifier text\n2. Reference full ammunition objects (similar to trait enrichment from DB)\n3. Leave as-is (current simple approach)\n\nTrade-offs:\n- Option 1: More structured but requires parsing logic for varied formats\n- Option 2: More complete data but requires ammunition database and linking\n- Option 3: Simple and works, but less queryable/processable\n\nNeed to consider:\n- How is this data used downstream?\n- Are there queries that need price/bulk of ammunition?\n- Is consistency with other equipment fields important?\n- What formats do ammunition modifiers actually use across all equipment?","created_at":"2026-01-14T22:17:13Z"}]}
{"id":"PFSRD2-Parser-0yd","title":"Code simplification and refactoring","description":"Epic for all complexity reduction, function decomposition, and code consolidation work. Includes breaking down oversized functions and extracting shared utilities.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-01T23:08:44.975688069Z","updated_at":"2026-02-01T23:08:44.975688069Z","dependencies":[{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-xan","type":"blocks","created_at":"2026-02-01T23:09:01.560913725Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-76k","type":"blocks","created_at":"2026-02-01T23:09:01.582803547Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-t70","type":"blocks","created_at":"2026-02-01T23:09:01.604346455Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-4zs","type":"blocks","created_at":"2026-02-01T23:09:01.62597516Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-8as","type":"blocks","created_at":"2026-02-01T23:09:01.647263323Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-9kp","type":"blocks","created_at":"2026-02-01T23:09:01.668265369Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-fl4","type":"blocks","created_at":"2026-02-01T23:09:01.689268959Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-n6d","type":"blocks","created_at":"2026-02-01T23:09:01.710094784Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-bg7","type":"blocks","created_at":"2026-02-01T23:09:01.731667439Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-7on","type":"blocks","created_at":"2026-02-01T23:09:01.753132306Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-0yd","depends_on_id":"PFSRD2-Parser-j98","type":"blocks","created_at":"2026-02-01T23:09:01.774449064Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-1td","title":"Remove defensive empty check in _parse_immunities","description":"Lines 1671-1674: Checks for empty text and returns empty list. If parsing immunities from empty text, that's data quality issue that should be caught earlier.\n\nStrategic fragility: Remove check - let BeautifulSoup handle empty input (will return empty list naturally).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:57.58549182Z","updated_at":"2026-01-15T02:51:07.252064528Z","closed_at":"2026-01-15T02:51:07.252064528Z","close_reason":"Removed defensive empty check. BeautifulSoup handles empty input naturally. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-1td","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.172787732Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4et","title":"Remove unnecessary empty check in _count_links_in_html","description":"Lines 37-38: Defensive 'if not html_text: return 0' check. If counting links in non-existent HTML, that's likely a caller bug. BeautifulSoup handles empty strings fine.\n\nStrategic fragility: Remove check, let BeautifulSoup handle empty input (will just find no links).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:53:56.589943001Z","updated_at":"2026-01-15T00:36:29.137357511Z","closed_at":"2026-01-15T00:36:29.137357511Z","close_reason":"Removed defensive empty check. BeautifulSoup handles empty strings correctly. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-4et","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.013499315Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4qc","title":"Add pytest to GitHub CI workflow","description":"Currently .github/workflows/lint.yml only runs black and ruff. Need to add pytest so failing tests block PRs.\n\nShould add a test job that:\n- Installs test dependencies (pytest, beautifulsoup4, etc.)\n- Runs python -m pytest tests/ -v","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-03T22:08:56.223460512Z","updated_at":"2026-02-03T22:48:52.670636891Z","closed_at":"2026-02-03T22:48:52.670636891Z","close_reason":"Fixed in PR #37","dependencies":[{"issue_id":"PFSRD2-Parser-4qc","depends_on_id":"PFSRD2-Parser-eh5","type":"blocks","created_at":"2026-02-03T22:41:33.972718408Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4qu","title":"Simplify try-except with re-raise in normalization","description":"Lines 1402-1404, 1640-1642, 1799-1801: Catching ValueError and re-raising with context. While context is useful, if input data is bad, should fail fast at parsing boundary, not here.\n\nStrategic fragility: Just convert - let ValueError propagate with its own message showing the bad value.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:35.670058561Z","updated_at":"2026-01-15T03:17:36.098910938Z","closed_at":"2026-01-15T03:17:36.098910938Z","close_reason":"Removed 10 try-except blocks with ValueError re-raise. Native ValueError messages already show bad values. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-4qu","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.11309246Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-4r8","title":"Fix link accounting failures (291 files)","description":"Parser fails with: AssertionError: Link accounting failed in [filename]: started with X links in HTML, ended with Y link objects in JSON\n\nThe parser validates that all HTML \u003ca\u003e tags are properly extracted into structured link objects. When counts don't match, it indicates links are being lost or gained during parsing.\n\n**Affected: 291 files (37% of all errors)**\n\n**Pattern breakdown:**\n- 255 files lost links (517 total links lost)\n- 36 files gained links (59 total links gained)\n- Most common: lose exactly 1 link (143 files)\n- Common: lose 2 links (62 files)\n\n**Example files to investigate:**\n- Equipment.aspx.ID_244.html (26 → 25, lost 1)\n- Equipment.aspx.ID_290.html (3 → 2, lost 1)\n- Equipment.aspx.ID_291.html (3 → 2, lost 1)\n- Equipment.aspx.ID_317.html (5 → 4, lost 1)\n- Equipment.aspx.ID_319.html (10 → 9, lost 1)\n\n**Likely fix:**\n- Debug why links are being lost during HTML-to-JSON conversion\n- Check if certain link types are not being extracted (internal refs, anchors, etc.)\n- Look for links in unexpected DOM locations","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-23T03:28:10.3795191Z","updated_at":"2026-01-23T03:28:10.3795191Z"}
{"id":"PFSRD2-Parser-4zs","title":"Refactor: Break down _extract_ability_fields function (~56 lines)","description":"The _extract_ability_fields function in equipment.py is approximately 56 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964777","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:16.922378184Z","updated_at":"2026-02-06T20:28:33.731417546Z","closed_at":"2026-02-06T20:28:33.731417546Z","close_reason":"Decomposed into _collect_siblings_until_bold, _clean_field_value_html, _remove_soup_nodes, ABILITY_FIELD_NAMES","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-5h9","title":"Add unit tests for _parse_activation_types","description":"Add direct unit tests for _parse_activation_types() in equipment.py. Currently has integration test coverage but lacks unit tests for edge cases: empty string, single value, comma-separated values, semicolon-separated values, values with parentheses.\n\nFrom PR #32 review comment by test-coverage-reviewer.\nFile: pfsrd2/equipment.py:2995","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-23T01:46:33.481359171Z","updated_at":"2026-01-23T02:51:21.76065128Z","closed_at":"2026-01-23T02:51:21.76065128Z","close_reason":"Added 34 unit tests for _parse_activation_types and related helper functions"}
{"id":"PFSRD2-Parser-70t","title":"Remove default None from group_subtype parameter","description":"Line 941: Function signature has group_subtype=None default, making it unclear if parameter is required or optional. This hides whether callers need to provide this value.\n\nStrategic fragility: No default - force caller to be explicit. Pass None at call site if not needed.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:48.820469569Z","updated_at":"2026-01-15T00:16:35.508688439Z","closed_at":"2026-01-15T00:16:35.508688439Z","close_reason":"Removed default None parameter. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-70t","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.993404124Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-76k","title":"Consolidate field_destinations into canonical base with overrides","description":"The current equipment configs each define their own field_destinations dict, leading to duplication and fragility. \n\nCurrent state: Each equipment type (armor, shield, weapon, siege_weapon, vehicle, equipment) has its own field_destinations mapping.\n\nProposed: Create a canonical DEFAULT_FIELD_DESTINATIONS dict that covers the common cases, then allow individual equipment type configs to override specific fields as needed.\n\nExample approach:\n```python\nDEFAULT_FIELD_DESTINATIONS = {\n    'price': None,           # top-level stat_block\n    'bulk': None,\n    'hardness': 'defense',\n    'hp_bt': 'defense',\n    # ... common fields\n}\n\nEQUIPMENT_CONFIGS = {\n    'armor': {\n        'field_destinations': {\n            **DEFAULT_FIELD_DESTINATIONS,\n            'ac_bonus': 'defense',  # armor-specific\n            'dex_cap': 'defense',\n            # ... overrides\n        },\n    },\n}\n```\n\nThis reduces duplication and makes it clearer which fields are standard vs type-specific.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-21T17:49:50.003768143Z","updated_at":"2026-02-05T03:36:00.757716452Z","closed_at":"2026-02-05T03:36:00.757716452Z","close_reason":"Closed"}
{"id":"PFSRD2-Parser-7on","title":"Refactor: Break down _extract_abilities function (~210 lines)","description":"The _extract_abilities function in equipment.py is approximately 210 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964115","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:07.386066205Z","updated_at":"2026-02-03T03:11:52.353264675Z","closed_at":"2026-02-03T03:11:52.353264675Z","close_reason":"Refactored _extract_abilities into 7 helper functions. All tests pass, zero data diffs.","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-81b","title":"Fix creature parser HTML5 regressions (42 errors)","description":"","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-13T01:03:12.347616334Z","updated_at":"2026-02-13T01:03:16.83866665Z"}
{"id":"PFSRD2-Parser-8as","title":"Refactor: Break down _parse_equipment_variant function (~61 lines)","description":"The _parse_equipment_variant function in equipment.py is approximately 61 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964664","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:15.358395266Z","updated_at":"2026-02-06T20:28:35.29867913Z","closed_at":"2026-02-06T20:28:35.29867913Z","close_reason":"Decomposed into _parse_variant_name_and_level, _collect_content_until_h2","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-9en","title":"Fix missing traits in database errors (67 files)","description":"Parser fails with: AssertionError: Trait not found in database: [trait] (original: [original])\n\nThe parser validates all traits against a database of known traits. Unrecognized traits cause failures.\n\n**Affected: 67 files (8.5% of all errors)**\n\n**Most common \"missing\" traits (actually misidentified):**\n- add (18) - likely misidentified activation type\n- envision (16) - valid activation type, not a trait\n- command (14) - valid activation type, not a trait\n- minute/minutes (9) - durations, not traits\n- concentration (2) - valid component/trait\n- CN, LN, LG (4) - alignment abbreviations\n- Treat (1) - case sensitivity issue\n- NULL, ., empty (3) - data quality issues\n\n**Example files to investigate:**\n- Equipment.aspx.ID_253.html - trait: \"command\"\n- Equipment.aspx.ID_261.html - trait: \"Treat\"\n- Equipment.aspx.ID_262.html - trait: \"envision\"\n- Equipment.aspx.ID_509.html - trait: \"minute\"\n- Equipment.aspx.ID_513.html - trait: \"envision\"\n- Equipment.aspx.ID_541.html - trait: \"command\"\n- Equipment.aspx.ID_728.html - trait: \"envision\"\n\n**Likely fix:**\n- Fix trait extraction to distinguish traits from activation types (command, envision)\n- Filter out durations (minute, minutes) from trait parsing\n- Handle alignment abbreviations separately\n- Fix case sensitivity issues","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-23T03:28:27.659032336Z","updated_at":"2026-01-23T03:28:27.659032336Z"}
{"id":"PFSRD2-Parser-9kp","title":"Refactor: Break down _extract_heading_sections function (~68 lines)","description":"The _extract_heading_sections function in equipment.py is approximately 68 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964519","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:13.738581055Z","updated_at":"2026-02-06T20:28:36.841424147Z","closed_at":"2026-02-06T20:28:36.841424147Z","close_reason":"Decomposed into _is_variant_marker_heading, _get_heading_level, _get_content_until_next_heading, _build_section_from_heading","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-a2z","title":"Fix HTML: Frogskin Tincture (ID 3234) has misplaced Hive Mother Bottle image","description":"Equipment.aspx.ID_3234.html (Frogskin Tincture) contains two image links: Frogskin_Tincture.webp and Hive_Mother_Bottle.webp. The Hive Mother Bottle image belongs to its own page (ID 3231) and should not be on the Frogskin Tincture page. Fix: move or remove the Hive_Mother_Bottle.webp image link from the ID 3234 HTML source in pfsrd2-web.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-11T01:48:44.012370852Z","updated_at":"2026-02-11T01:48:44.012370852Z"}
{"id":"PFSRD2-Parser-ahp","title":"Fix 11 broken unit tests in test_equipment_helpers.py and test_equipment_activation.py","description":"11 tests are failing but CI doesn't catch them because we only have a lint workflow.\n\nFailing tests:\n- TestMultipleActivationTypes::test_item_489_activation_types_as_list\n- TestMultipleActivationTypes::test_item_759_multiple_activation_types\n- TestParseActivationContent::test_extracts_simple_activation_type\n- TestParseActivationContent::test_extracts_multiple_activation_types\n- TestParseActivationContent::test_activation_before_parentheses\n- TestParseActivationContent::test_non_trait_links_added_to_links\n- TestParseActivationContent::test_handles_unlinked_traits_in_parentheses\n- TestParseActivationTypes::test_comma_separated_values\n- TestParseActivationTypes::test_semicolon_separated_values\n- TestParseActivationTypes::test_preserves_parentheses\n- TestParseActivationTypes::test_strips_whitespace\n\nAll related to _parse_activation_types and _parse_activation_content functions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-03T22:08:54.190325878Z","updated_at":"2026-02-03T22:48:52.666609612Z","closed_at":"2026-02-03T22:48:52.666609612Z","close_reason":"Fixed in PR #37","dependencies":[{"issue_id":"PFSRD2-Parser-ahp","depends_on_id":"PFSRD2-Parser-eh5","type":"blocks","created_at":"2026-02-03T22:41:33.996071976Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-auw","title":"Deduplicate trait_class_matcher function (defined 3 times)","description":"Lines 767-775, 800-807, 842-854: Same trait_class_matcher function defined THREE times in different scopes. Also has defensive 'if not c' check.\n\nStrategic fragility: Define once at module level, remove None check (BeautifulSoup API guarantees string or list).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:04.396741031Z","updated_at":"2026-01-15T00:44:41.266379586Z","closed_at":"2026-01-15T00:44:41.266379586Z","close_reason":"Deduplicated 3 identical function definitions into single module-level function. Kept defensive None check - testing revealed BeautifulSoup can pass None despite task description. All equipment types parse successfully.","dependencies":[{"issue_id":"PFSRD2-Parser-auw","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.032094631Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-bcl","title":"Implement siege weapons parser","description":"Add siege weapons as a new equipment type to PFSRD2-Parser. Parse siege weapon HTML files with stats (Price, Usage, Crew, Proficiency, etc.), defensive stats (AC, Fort, Ref), item hitpoints (HP, Hardness, Immunities), and action sections (Aim, Load, Launch, Ram). Actions may have attack-like properties (damage, range, saving throws). Must also parse item level (like 'Item 1').","design":"Following the extensible equipment architecture pattern from weapons/armor/shields. Key implementation steps:\n1. Schema: Renamed shield_hitpoints to item_hitpoints, added protection/protections defs for immunities support (DONE)\n2. Equipment.py: Created _normalize_item_hitpoints() with immunities parsing from creatures pattern (DONE)\n3. Equipment.py: Added siege_weapon configuration to EQUIPMENT_TYPES with recognized_stats mapping (DONE)\n4. Need to implement: _normalize_defensive_stats() for AC/Fort/Ref parsing\n5. Need to implement: _normalize_speed() for speed field\n6. Need to implement: Action section parsing (Aim, Load, Launch, Ram) using extract_action_type from pfsrd2.action\n7. Need to implement: Attack parsing for Launch actions (damage, range, DC, burst)\n8. Need to implement: Item level parsing ('Item 1' format)\n9. Schema: Add siege_weapon_object definition\n10. Test on all 32 HTML files","notes":"COMPLETED: Full siege weapon parser implementation.\n- Schema: item_hitpoints with immunities, siege_weapon_object definition, speed_with_modifiers\n- Equipment.py: siege_weapon config in EQUIPMENT_TYPES, _siege_weapon_section_pass, _extract_siege_weapon_stats (handles multi-\u003chr\u003e layout), _extract_action_sections (parses Aim/Load/Launch/Ram with action costs), normalize_siege_weapon_fields  \n- Parsing: item level from h1, all stats (usage/crew/proficiency/ammunition/space/ac/fort/ref/hardness/hp/immunities/speed), actions with action_type, traits, source, price\n- Normalization: defensive stats, speed with modifiers, item_hitpoints with immunities, immunities parser\nTESTED: Successfully parses Bombard (ID 12) with all fields correctly structured.\nNEXT: Test on remaining 31 files to identify edge cases, validate schema passes, create unified runner script.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-13T06:32:21.803545679Z","updated_at":"2026-01-13T06:48:10.422100884Z"}
{"id":"PFSRD2-Parser-bg7","title":"Refactor: Break down _parse_activation function (~89 lines)","description":"The _parse_activation function in equipment.py is approximately 89 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964225","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:08.979385536Z","updated_at":"2026-02-06T20:28:41.482453306Z","closed_at":"2026-02-06T20:28:41.482453306Z","close_reason":"Decomposed into _extract_traits_from_time_part, _TIME_PATTERN, _TIME_ONLY_PATTERN constants","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-cnd","title":"Remove defensive hardness deletion in hitpoints normalization","description":"Lines 1636-1642: Uses .get('hardness') and checks is not None. If hardness field exists, it should be valid. Empty/None hardness should fail.\n\nStrategic fragility: Use 'if hardness in sb' check, convert directly with int(sb['hardness']).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:43.740092565Z","updated_at":"2026-01-15T03:22:31.180286352Z","closed_at":"2026-01-15T03:22:31.180286352Z","close_reason":"Removed defensive .get() with None check. Simplified from 7 lines to 2 lines. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-cnd","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.132761019Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-eb1","title":"Rework activate: activations array vs polymorphic ability extension","description":"The activate pattern is becoming sticky and a poor fit for ability - like affliction, it's a superset of ability rather than fitting cleanly into it.\n\nTwo approaches to consider:\n\n1. **Activations array approach**: Create an `activations` array containing `activate` objects. Each activate object can hold an `ability` plus have the `activation` field on it. This separates concerns cleanly.\n\n2. **Polymorphic extension approach**: If JSON Schema supports any kind of polymorphism (oneOf, allOf, discriminator patterns), consider extending the `ability` object to become an `activation` object - essentially making activation a specialized subtype of ability.\n\nResearch needed:\n- Review JSON Schema polymorphism options (oneOf with discriminator, allOf for inheritance-like patterns)\n- Examine how affliction currently handles being a superset of ability\n- Determine which approach better fits the existing schema patterns and parser architecture\n\nThis affects equipment.py parsing and pfsrd2/schema/equipment.schema.json.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-21T17:20:09.858795327Z","updated_at":"2026-01-22T17:49:13.273959055Z","closed_at":"2026-01-22T17:49:13.273959055Z","close_reason":"Activation type implementation complete. Created separate 'activation' subtype with structured activation_types array, consistent 'Activate' name with optional activation_name field, proper cruft cleanup, and modular price parsing."}
{"id":"PFSRD2-Parser-eh5","title":"Test coverage improvements","description":"Long-running epic for tracking unit test coverage across the project. Attach new testing issues here as dependencies. This epic stays open and serves as the central tracker for all test-related work — new test coverage, test fixes, CI improvements, and regression tests for bug fixes.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-01T23:08:46.564353417Z","updated_at":"2026-02-04T17:36:42.768536479Z"}
{"id":"PFSRD2-Parser-fl4","title":"Refactor: Break down _extract_activate_stat function (~71 lines)","description":"The _extract_activate_stat function in equipment.py is approximately 71 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964407","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:12.151925863Z","updated_at":"2026-02-06T20:28:38.3834258Z","closed_at":"2026-02-06T20:28:38.3834258Z","close_reason":"Decomposed into _skip_leading_whitespace, _clean_activate_content","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-flp","title":"Remove triple defensive check before parsing immunities","description":"Lines 1647-1652: Three levels of defensive checking: (1) field exists, (2) not empty, (3) parsed result not empty. Hides data quality issues.\n\nStrategic fragility: Just parse immunities if field exists, let parser handle empty input.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:54:50.668998566Z","updated_at":"2026-01-15T03:28:59.815774665Z","closed_at":"2026-01-15T03:28:59.815774665Z","close_reason":"Removed defensive empty string check. Simplified from 3-level checking to 2-level. BeautifulSoup handles empty strings naturally. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-flp","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.152777847Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-g0y","title":"Refactor: Break down _parse_activation_content function (~103 lines)","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-04T20:50:03.687391283Z","updated_at":"2026-02-04T23:43:58.989047126Z","closed_at":"2026-02-04T23:43:58.989047126Z","close_reason":"Tracked during PR #38 review - _parse_activation_content time parsing block identified as extractable","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-gcc","title":"Replace silent return with exception on empty stat block","description":"Lines 457-458, 496-497, 521-522: Multiple places use .get('text', '') and silently return 0 if empty. If stat block exists without text, that's a bug in earlier processing.\n\nStrategic fragility: Use sb['text'] to fail if missing, raise ValueError if empty instead of silently returning.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:12.048023959Z","updated_at":"2026-01-15T01:18:43.642250341Z","closed_at":"2026-01-15T01:18:43.642250341Z","close_reason":"Replaced silent returns with exceptions. Uses sb['text'] to fail if missing, raises ValueError if empty. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-gcc","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.051895217Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-gxu","title":"Define preferred if-statement style guidelines","description":"Define the project's preferred style for if statements - when to use nested ifs vs combined ifs with 'and'. Update AGENT-REVIEWERS.md or create a style guide with the decision.\n\nRelated: SIM102 lint rule is currently ignored pending this decision.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-22T06:01:46.695717064Z","updated_at":"2026-01-22T06:01:46.695717064Z"}
{"id":"PFSRD2-Parser-h2u","title":"Consider preserving href-only links in get_links","description":"The `get_links` function in `universal/universal.py` filters out links that don't have a `game-obj` attribute:\n\n```python\n# Only extract links with game-obj attribute (structured references to game objects)\n# Skip arbitrary navigation links without game-obj\nif not a.has_attr('game-obj'):\n    if unwrap:\n        a.unwrap()\n    continue\n```\n\nThis was added in commit 21162e9 (PR #12 - shields support).\n\n**Effect:** Links like `Equipment.aspx?Category=6\u0026Subcategory=7` (pointing to equipment category lists) are now excluded from extracted links in traits and other parsed content.\n\n**Current behavior:** These href-only links are stripped. Re-running parsers removes them from previously generated data.\n\n**Potential future work:** Add an option to `get_links(bs, unwrap=False, include_href_only=False)` to optionally preserve these navigation links for cases where they might be useful.\n\n**Examples of removed links:**\n- `Equipment.aspx?Category=6\u0026Subcategory=7` (bombs)\n- `Equipment.aspx?Category=6\u0026Subcategory=8` (elixirs)  \n- `AnimalCompanions.aspx`\n- `Shields.aspx`","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-22T02:13:20.196804422Z","updated_at":"2026-01-22T02:13:20.196804422Z"}
{"id":"PFSRD2-Parser-hy1","title":"Apply Black formatting and fix linting issues across codebase","description":"Black and flake8 have been added to the project (pyproject.toml, requirements.txt).\n\n## Tasks\n\n1. **Run Black on all Python files** to standardize formatting:\n   - Quote style (single → double)\n   - Line length (100 chars configured)\n   - Consistent spacing and line breaks\n\n2. **Fix flake8 issues**:\n   - Unused imports\n   - Undefined names\n   - Line length violations\n   - Other PEP8 issues\n\n3. **Clean up existing function-level imports** (equipment.py has ~50 pre-existing violations beyond the ones fixed in PR #28)\n\n## Commands\n\n```bash\n# Check what Black would change\nblack --check --diff pfsrd2/\n\n# Apply Black formatting\nblack pfsrd2/\n\n# Run flake8\nflake8 pfsrd2/\n```\n\n## Notes\n- Black cannot format partial files - it's all or nothing\n- Use `# fmt: off` / `# fmt: on` to protect specific sections if needed\n- Consider running on a per-file basis to keep PRs reviewable","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T01:15:45.855862551Z","updated_at":"2026-01-22T01:21:22.068904901Z","closed_at":"2026-01-22T01:21:22.068904901Z","close_reason":"Black formatting applied across codebase in PR #29"}
{"id":"PFSRD2-Parser-j98","title":"Refactor: Extract _replace_entities to shared utility","description":"The _replace_entities function is duplicated in equipment.py. Should be extracted to a shared utility module.\n\nReference: PR #34 agent review comment 2751964046","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:05.787795534Z","updated_at":"2026-02-02T20:57:00.230260794Z","closed_at":"2026-02-02T20:57:00.230260794Z","close_reason":"Merged as PR #35","labels":["refactoring","technical-debt"]}
{"id":"PFSRD2-Parser-jnj","title":"Fix invalid HTML tags in markdown (114 files)","description":"Parser fails with: AssertionError: [ItemName] : [text snippet] - {set of invalid tags}\n\nAfter parsing HTML to markdown, the validator checks for remaining HTML tags. Unexpected tags trigger this error.\n\n**Affected: 114 files (14.5% of all errors)**\n\n**Top invalid tags found:**\n- span (66), b (65), br (64), u (54), h2 (45)\n- table/tr/td (42 each), i (41), h3 (26), th (6)\n\n**Malformed placeholder patterns:**\n- treasure%XXX%% (IDs 291, 292, 300, 308)\n- tableshtml#XX%% (IDs 35, 36, 305)\n- actions#XXX%% (IDs 953, 1185)\n\n**Example files to investigate:**\n- Equipment.aspx.ID_142.html (Dragonhide Armor) - tableshtml, span, h2, b, i, sup, br\n- Equipment.aspx.ID_151.html (Dragonplate) - tableshtml, table, tr, td, h2, b\n- Equipment.aspx.ID_173.html (Aligned Oil) - treasure%291%% through treasure%308%%\n- Equipment.aspx.ID_185.html (Dragon's Breath Potion) - table, tr, td, h2, b, br\n- Equipment.aspx.ID_271-277.html (Special materials) - tables and formatting tags\n\n**Likely fix:**\n- Add support for common HTML tags in markdown conversion\n- Fix malformed placeholder pattern handling\n- Improve HTML-to-markdown conversion for tables","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-23T03:28:18.911811879Z","updated_at":"2026-01-23T03:28:18.911811879Z"}
{"id":"PFSRD2-Parser-l0b","title":"Simplify overly complex link counting in section removal","description":"Lines 1072-1078: Double-counts links by checking if element itself is a link AND finding descendant links. Defensive coding trying to handle all cases.\n\nStrategic fragility: Just use find_all with recursive=True - BeautifulSoup will find all links including elem itself.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:55:04.762880852Z","updated_at":"2026-01-15T04:14:04.579826174Z","closed_at":"2026-01-15T04:14:04.579826174Z","close_reason":"No changes needed - existing logic is correct. The double-counting (checking elem itself + descendants) is intentional for cases where an element is both a link and contains links.","dependencies":[{"issue_id":"PFSRD2-Parser-l0b","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.191231101Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-lkh","title":"Remove empty string handling in _extract_stat_value","description":"Lines 1015-1017: Checks for empty string and returns None. If stat label exists with no value, that's malformed HTML that should fail, not silently return None.\n\nStrategic fragility: Only handle em dash (explicit 'no value' marker), raise ValueError on empty string.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:19.834612083Z","updated_at":"2026-01-15T01:25:08.725585043Z","closed_at":"2026-01-15T01:25:08.725585043Z","close_reason":"Removed empty string handling. Only em dash is handled as 'no value' marker. Raises ValueError on empty string to catch malformed HTML. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-lkh","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.07175019Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-lru","title":"Fix missing DetailedOutput span errors (6 files)","description":"Parser fails with: AssertionError: Could not find DetailedOutput span\n\nThe parser expects a \u003cspan\u003e element with class/id \"DetailedOutput\" that contains the main equipment details, but this structure is missing.\n\n**Affected: 6 files (0.8% of all errors)**\n\n**All affected files:**\n- Equipment.aspx.ID_34.html\n- Equipment.aspx.ID_212.html\n- Equipment.aspx.ID_368.html\n- Equipment.aspx.ID_434.html\n- Equipment.aspx.ID_436.html\n- Equipment.aspx.ID_542.html\n\n**Likely fix:**\n- Investigate these 6 files to understand their HTML structure\n- Add fallback parsing logic for non-standard equipment page layouts\n- May be a different page template or special equipment type","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-23T03:28:34.234343121Z","updated_at":"2026-01-23T03:28:34.234343121Z"}
{"id":"PFSRD2-Parser-n6d","title":"Refactor: Break down _extract_affliction function (~82 lines)","description":"The _extract_affliction function in equipment.py is approximately 82 lines long and should be broken down into smaller, more maintainable functions.\n\nReference: PR #34 agent review comment 2751964305","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:10.566894947Z","updated_at":"2026-02-06T20:28:39.953190912Z","closed_at":"2026-02-06T20:28:39.953190912Z","close_reason":"Decomposed into _collect_preceding_whitespace, _collect_node_and_following, _create_affliction_stage, _normalize_affliction_text","labels":["complexity","refactoring"]}
{"id":"PFSRD2-Parser-rev","title":"Remove defensive .get('group_subtype') hiding config errors","description":"Line 469: Using .get('group_subtype') with default None hides configuration errors. If group_subtype is required for an equipment type but missing from config, we silently pass None instead of failing fast.\n\nStrategic fragility: Force callers to pass group_subtype explicitly or use config['group_subtype'] to fail on missing config.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:41.632266784Z","updated_at":"2026-01-15T00:23:54.748292761Z","closed_at":"2026-01-15T00:23:54.748292761Z","close_reason":"Replaced defensive .get() with explicit fail-fast check. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-rev","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.974006533Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-roq","title":"Remove defensive type check in ammunition normalization","description":"Line 1996-1997: isinstance(html_str, dict) check with comment 'shouldn't be, but be defensive'. This hides bugs where ammunition is already a dict. Remove the check and let it fail with TypeError if html_str is not a string.\n\nStrategic fragility: If ammunition is already a dict, that's a bug that should fail loudly, not be silently skipped.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-14T23:53:34.403041289Z","updated_at":"2026-01-15T00:30:43.732680451Z","closed_at":"2026-01-15T00:30:43.732680451Z","close_reason":"Removed defensive isinstance check. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-roq","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:56.95375157Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-spu","title":"Move defensive equipment group check to call site","description":"Lines 1834-1836: Checks if 'group_table' in config inside the function. Defensive - function is called for all equipment types but shields don't have groups.\n\nStrategic fragility: Remove check from function, only call equipment_group_pass() from call site if config has group_table.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-14T23:55:12.357321178Z","updated_at":"2026-01-15T04:14:03.001250851Z","closed_at":"2026-01-15T04:14:03.001250851Z","close_reason":"Successfully moved defensive equipment group check to call site. Validated with all equipment parsers - no errors, no data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-spu","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.209727934Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-t5b","title":"Testing: Add unit tests for affliction parsing functions","description":"Add unit tests for affliction parsing functions in equipment.py to ensure proper coverage and prevent regressions.\n\nReference: PR #34 agent review comment 2751964366","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-01T21:22:18.488695318Z","updated_at":"2026-02-01T23:06:41.439613559Z","closed_at":"2026-02-01T23:06:41.439613559Z","close_reason":"Added 23 unit tests (8 for _has_affliction_pattern, 15 for _extract_affliction)","labels":["technical-debt","testing"]}
{"id":"PFSRD2-Parser-t70","title":"Consolidate entity handling utilities","description":"The equipment.py parser has _replace_entities function that duplicates filter_entities from universal/utils.py but adds 5 additional HTML entity encoded variants. These should be added to filter_entities to make it more complete, then equipment.py should use the universal version. This will reduce code duplication and make entity handling consistent across all parsers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-21T04:07:46.667174219Z","updated_at":"2026-02-06T19:38:14.448486292Z","closed_at":"2026-02-06T19:38:14.448486292Z","close_reason":"Already completed in PR #35 (commit a387006). Entity handling consolidated in universal/utils.py."}
{"id":"PFSRD2-Parser-t9y","title":"Add warning when fallback logic used in creatures.py _pick_best_ability","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-01T22:33:52.881671372Z","updated_at":"2026-02-01T22:33:52.881671372Z"}
{"id":"PFSRD2-Parser-vwo","title":"Equipment parser error fixes","description":"Fix the 796 equipment parsing errors across 5 categories. Current success rate is 76% (2624/3420 files).","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-23T03:27:54.184075661Z","updated_at":"2026-01-23T03:27:54.184075661Z","dependencies":[{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-wei","type":"blocks","created_at":"2026-01-23T03:28:42.603911959Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-4r8","type":"blocks","created_at":"2026-01-23T03:28:42.624106568Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-jnj","type":"blocks","created_at":"2026-01-23T03:28:42.645793883Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-9en","type":"blocks","created_at":"2026-01-23T03:28:42.665702095Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-lru","type":"blocks","created_at":"2026-01-23T03:28:42.685924979Z","created_by":"daemon"},{"issue_id":"PFSRD2-Parser-vwo","depends_on_id":"PFSRD2-Parser-0lt","type":"blocks","created_at":"2026-01-23T03:29:39.015391581Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-wei","title":"Fix missing equipment name link errors (308 files)","description":"Parser fails with: AssertionError: Could not find equipment name link (type=equipment)\n\nThe parser expects to find a specific link element identifying the equipment name within the HTML structure, but it's not present in the expected format.\n\n**Affected: 308 files (39% of all errors)**\n\n**Example files to investigate:**\n- Equipment.aspx.ID_490.html\n- Equipment.aspx.ID_500.html\n- Equipment.aspx.ID_508.html\n- Equipment.aspx.ID_560.html\n- Equipment.aspx.ID_588.html\n- Equipment.aspx.ID_591-593.html\n- Equipment.aspx.ID_595-625.html\n\n**Likely fix:**\n- Investigate alternative HTML structures for equipment name extraction\n- Add fallback logic to find equipment names in different DOM locations\n- Consider relaxing strict link type requirements","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-23T03:28:02.617388161Z","updated_at":"2026-01-23T04:26:32.374817436Z","closed_at":"2026-01-23T04:26:32.374817436Z","close_reason":"Fixed all 308 errors by adding Structure C fallback to extract plain text names from h1.title"}
{"id":"PFSRD2-Parser-x17","title":"Simplify complex defensive loop in _extract_description","description":"Lines 1220-1230: Complex defensive walking backward through siblings with multiple break conditions. Suggests lack of confidence in HTML structure.\n\nStrategic fragility: Trust HTML structure. Action icons should follow action names. Simplify to just remove span and preceding br.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-14T23:54:27.585984462Z","updated_at":"2026-01-15T02:33:06.498013372Z","closed_at":"2026-01-15T02:33:06.498013372Z","close_reason":"Simplified 30+ line defensive loop to simple 3-step removal. Trusts HTML structure. All equipment types parse successfully with no errors or data changes.","dependencies":[{"issue_id":"PFSRD2-Parser-x17","depends_on_id":"PFSRD2-Parser-xp4","type":"parent-child","created_at":"2026-01-15T00:00:57.091787278Z","created_by":"daemon"}]}
{"id":"PFSRD2-Parser-xan","title":"Decompose complex ability extraction functions","description":"Complexity review identified two functions that need decomposition:\n\n## _extract_abilities_from_description (~270 lines)\n\nFails and/or test with 5+ responsibilities:\n- Extract offensive abilities from content\n- Parse action types\n- Extract sub-fields (Frequency, Trigger, Effect, Requirements)\n- Handle named activations (e.g., \"—Dim Sight\")\n- Convert trait links to trait objects\n\n**Suggested extractions:**\n| Lines | New Function | Purpose |\n|-------|--------------|---------|\n| 68-110 | `_extract_ability_subfields(soup, ability)` | Extract Frequency/Trigger/Effect/Requirements |\n| 115-140 | `_parse_named_activation(soup)` | Handle em-dash prefixed activation names |\n| 160-200 | `_process_traits_in_parens(text, trait_links)` | Parse \"(trait1, trait2)\" and match to links |\n\n## _normalize_activate_to_ability (~100 lines)\n\nBorderline complexity with duplicated logic:\n- Trait-in-parentheses logic duplicated from _extract_abilities_from_description\n\n**Recommendation:** Extract shared `_process_traits_in_parens` helper to DRY up both functions.\n\n## Acceptance criteria\n- Each extracted function passes the and/or test (describable without conjunctions)\n- No function exceeds ~60 lines\n- Shared logic is consolidated into reusable helpers","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T01:09:07.718718587Z","updated_at":"2026-02-04T19:26:21.217644004Z","closed_at":"2026-02-04T19:26:21.217644004Z","close_reason":"Decomposed _extract_abilities_from_description and _normalize_activate_to_ability. Created 6 new helpers. Also fixed bug where '1 minute' activation time was incorrectly treated as activation_type."}
{"id":"PFSRD2-Parser-xp4","title":"Remove defensive programming from PR #12","description":"Strategic fragility review of PR #12 identified 14 instances of defensive programming that should be removed. Each issue will be fixed one-by-one with testing on all equipment types (weapons, armor, shields, siege_weapons) to see what breaks.\n\nGoal: Make the code fail fast and loudly when invariants are violated instead of hiding bugs with defensive checks.\n\nCategories:\n- Critical (P0): 3 issues - Type checks, config hiding, default params\n- High (P1): 5 issues - Empty checks, duplicated code, silent returns  \n- Medium (P2): 6 issues - Try-except, complex conditionals\n\nTesting protocol for each fix:\n1. Apply fix\n2. Run full test suite on weapons, armor, shields, siege_weapons\n3. Document what breaks (if anything)\n4. Determine if breakage reveals real bugs or is acceptable\n\nRelated PR: #12 (shields support and equipment parsing unification)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-15T00:00:27.910205877Z","updated_at":"2026-01-15T04:14:29.081061684Z","closed_at":"2026-01-15T04:14:29.081061684Z","close_reason":"Successfully completed all 14 tasks. All changes validated with zero data impact. Strategic fragility successfully applied - code now fails fast and loudly instead of hiding bugs."}
{"id":"PFSRD2-Parser-zkt","title":"Separate link accounting counters (trait conversions vs dedup removals)","description":"Currently trait_links_converted conflates two concepts: links converted to trait objects and links removed by dedup. Separating these into distinct counters would make link accounting validation clearer and easier to debug. See PR #40 strategic-fragility-reviewer comment on line 4411.","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-11T01:02:07.242208367Z","updated_at":"2026-02-11T01:02:07.242208367Z"}
{"id":"PFSRD2-Parser-zl6","title":"Add edition field to monster abilities","description":"The monster_ability_db_pass function in creatures.py uses REMASTERED_SOURCES as a workaround to determine edition from source names. Monster abilities should have an edition field directly (like creatures do via edition_pass), eliminating the need for this source-based inference.\n\nRelated PR: #31\nFile: pfsrd2/creatures.py:394-403","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-22T05:34:29.672971271Z","updated_at":"2026-01-22T05:34:29.672971271Z"}
